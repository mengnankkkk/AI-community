# RAG çŸ¥è¯†åº“å®‰è£…å®Œæˆï¼

## âœ… å®‰è£…æ‘˜è¦

### å·²å®‰è£…çš„æ ¸å¿ƒä¾èµ–åŒ…ï¼š

| åŒ…å | ç‰ˆæœ¬ | çŠ¶æ€ |
|------|------|------|
| langchain | 0.1.0 | âœ… æ­£å¸¸ |
| langchain-community | 0.0.13 | âœ… æ­£å¸¸ |
| langchain-openai | 0.0.5 | âœ… æ­£å¸¸ |
| chromadb | 0.4.22 | âœ… æ­£å¸¸ |
| sentence-transformers | 5.1.1 | âœ… å·²å‡çº§ |
| beautifulsoup4 | 4.12.2 | âœ… æ­£å¸¸ |
| pypdf | 3.17.4 | âœ… æ­£å¸¸ |
| python-docx | 1.1.0 | âœ… æ­£å¸¸ |
| aiohttp | 3.9.1 | âœ… æ­£å¸¸ |

### ä¿®å¤çš„é—®é¢˜ï¼š

1. **PyPDF2 â†’ pypdf**
   - åŸå› ï¼šPyPDF2å·²è¢«pypdfå–ä»£
   - ä¿®æ”¹ï¼šæ›´æ–° `rag_knowledge_service.py` ä¸­çš„å¯¼å…¥è¯­å¥

2. **sentence-transformers å…¼å®¹æ€§**
   - åŸå› ï¼šç‰ˆæœ¬2.2.2ä¸æ–°ç‰ˆhuggingface_hubä¸å…¼å®¹
   - è§£å†³ï¼šå‡çº§åˆ°5.1.1

3. **é¡¹ç›®æ ¹ç›®å½•è·¯å¾„é”™è¯¯** âš ï¸ **å…³é”®ä¿®å¤**
   - åŸå› ï¼š`Path(__file__).parents[3]` æŒ‡å‘äº† `src/` è€Œä¸æ˜¯é¡¹ç›®æ ¹ç›®å½•
   - ç°è±¡ï¼šè‡ªåŠ¨å¯¼å…¥åŠŸèƒ½æ— æ³•æ‰¾åˆ° `data/knowledge_base/documents/` ç›®å½•
   - ä¿®æ”¹ï¼šæ”¹ä¸º `parents[4]` æ­£ç¡®æŒ‡å‘é¡¹ç›®æ ¹ç›®å½•
   - æ–‡ä»¶ï¼š`src/backend/app/services/rag_knowledge_service.py:32`

4. **è…¾è®¯æ··å…ƒåµŒå…¥æ¨¡å‹ API æ ¼å¼ä¸å…¼å®¹** âš ï¸ **å…³é”®ä¿®å¤**
   - åŸå› ï¼šLangChain çš„ OpenAIEmbeddings é»˜è®¤æ ¼å¼ä¸è…¾è®¯æ··å…ƒ API ä¸å®Œå…¨å…¼å®¹
   - ç°è±¡ï¼š`Error code: 400 - input å¿…é¡»ä¸º å­—ç¬¦ä¸² æˆ– å­—ç¬¦ä¸²æ•°ç»„`
   - è§£å†³ï¼šåˆ›å»ºä¸“ç”¨çš„ `HunyuanEmbeddings` é€‚é…å™¨ç±»
   - æ–°å¢æ–‡ä»¶ï¼š`src/backend/app/services/hunyuan_embeddings.py`
   - ä¿®æ”¹æ–‡ä»¶ï¼š`src/backend/app/services/rag_knowledge_service.py` ä½¿ç”¨æ–°é€‚é…å™¨

### åˆ›å»ºçš„æ–‡ä»¶å’Œç›®å½•ï¼š

```
E:\github\AI-community\
â”œâ”€â”€ src/
â”‚   â””â”€â”€ backend/
â”‚       â””â”€â”€ app/
â”‚           â””â”€â”€ services/
â”‚               â”œâ”€â”€ hunyuan_embeddings.py    â† æ–°å¢ï¼šè…¾è®¯æ··å…ƒåµŒå…¥æ¨¡å‹é€‚é…å™¨
â”‚               â””â”€â”€ rag_knowledge_service.py â† ä¿®æ”¹ï¼šä¿®å¤è·¯å¾„å’ŒAPIå…¼å®¹æ€§
â”œâ”€â”€ data/
â”‚   â””â”€â”€ knowledge_base/
â”‚       â”œâ”€â”€ documents/
â”‚       â”‚   â””â”€â”€ AIæŠ€æœ¯ä»‹ç».md  â† æµ‹è¯•æ–‡æ¡£
â”‚       â””â”€â”€ chroma_db/          â† å‘é‡æ•°æ®åº“ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ RAGçŸ¥è¯†åº“æ­å»ºæŒ‡å—.md    â† å®Œæ•´æ–‡æ¡£
â””â”€â”€ requirements.txt             â† å·²æ›´æ–°ä¾èµ–ç‰ˆæœ¬
```

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### æ–¹æ³•1ï¼šè‡ªåŠ¨å¯¼å…¥ï¼ˆæ¨èï¼‰

1. **æ·»åŠ æ›´å¤šçŸ¥è¯†æ–‡æ¡£**
   ```bash
   # å°†ä½ çš„æ–‡æ¡£æ”¾å…¥è¿™ä¸ªç›®å½•
   data/knowledge_base/documents/
   ```

2. **å¯ç”¨è‡ªåŠ¨å¯¼å…¥**ï¼ˆ`.env` æ–‡ä»¶ï¼‰
   ```bash
   RAG_AUTO_INGEST=true
   ```

3. **å¯åŠ¨åç«¯æœåŠ¡**
   ```bash
   cd src/backend
   python -m app.main
   ```

### æ–¹æ³•2ï¼šAPIæ‰‹åŠ¨å¯¼å…¥

```bash
# å¯åŠ¨æœåŠ¡åï¼Œä½¿ç”¨APIæ·»åŠ çŸ¥è¯†
POST http://localhost:8000/api/v1/knowledge/add-file
{
  "file_path": "path/to/your/document.pdf"
}
```

## ğŸ“Š éªŒè¯å®‰è£…

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•ï¼ˆå·²å®Œæˆï¼‰
```bash
.venv/Scripts/python.exe test_rag_setup.py
```
**ç»“æœï¼š** âœ… 7/7 æµ‹è¯•é€šè¿‡

### 2. è‡ªåŠ¨å¯¼å…¥åŠŸèƒ½æµ‹è¯•ï¼ˆå·²å®Œæˆï¼‰
```bash
.venv/Scripts/python.exe test_rag_auto_ingest.py
```
**æµ‹è¯•ç»“æœï¼š**
- âœ… é…ç½®æ­£ç¡®åŠ è½½ï¼ˆRAG_AUTO_INGEST=trueï¼‰
- âœ… è‡ªåŠ¨å‘ç°æ–‡æ¡£ï¼ˆAIæŠ€æœ¯ä»‹ç».mdï¼‰
- âœ… æˆåŠŸå¯¼å…¥åˆ°å‘é‡æ•°æ®åº“ï¼ˆ2ä¸ªæ–‡æ¡£ç‰‡æ®µï¼‰
- âœ… çŸ¥è¯†æ£€ç´¢æ­£å¸¸å·¥ä½œï¼ˆ"äººå·¥æ™ºèƒ½"æŸ¥è¯¢æˆåŠŸï¼‰
- âœ… æ•°æ®åº“å¤§å°ï¼š4.2 MB
- âœ… åµŒå…¥æ¨¡å‹ï¼šè…¾è®¯æ··å…ƒ hunyuan-embedding (1024ç»´)

## ğŸ¯ é…ç½®ä¿¡æ¯

```yaml
RAGå¯ç”¨: True
åµŒå…¥æ¨¡å‹æä¾›å•†: hunyuan
åµŒå…¥æ¨¡å‹: hunyuan-embedding
API Key: sk-wiTS... (å·²é…ç½®)
å‘é‡ç»´åº¦: 1024
çŸ¥è¯†åº“ç›®å½•: data/knowledge_base
å‘é‡å­˜å‚¨ç›®å½•: data/knowledge_base/chroma_db
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **è¯¦ç»†æŒ‡å—**: `docs/RAGçŸ¥è¯†åº“æ­å»ºæŒ‡å—.md`
- **æµ‹è¯•æ–‡æ¡£**: `data/knowledge_base/documents/AIæŠ€æœ¯ä»‹ç».md`

---

**å®‰è£…æ—¶é—´**: 2025-10-12
**Pythonç¯å¢ƒ**: 3.11.9 (.venv)
**çŠ¶æ€**: âœ… **å…¨éƒ¨å®Œæˆå¹¶éªŒè¯é€šè¿‡**

### å®Œæˆçš„å·¥ä½œæ¸…å•ï¼š
- [x] RAGæ ¸å¿ƒä¾èµ–å®‰è£…
- [x] PyPDF2 â†’ pypdf è¿ç§»
- [x] sentence-transformers ç‰ˆæœ¬å‡çº§
- [x] é¡¹ç›®æ ¹ç›®å½•è·¯å¾„ä¿®å¤
- [x] è…¾è®¯æ··å…ƒåµŒå…¥æ¨¡å‹é€‚é…å™¨å®ç°
- [x] è‡ªåŠ¨å¯¼å…¥åŠŸèƒ½ä¿®å¤å¹¶éªŒè¯
- [x] çŸ¥è¯†æ£€ç´¢åŠŸèƒ½æµ‹è¯•é€šè¿‡

### é—ç•™é—®é¢˜ï¼š
- âš ï¸ ChromaDB telemetry warningsï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- âš ï¸ pypdf ARC4 deprecation warningï¼ˆcryptographyåº“å°†åœ¨æœªæ¥ç‰ˆæœ¬ç§»é™¤ï¼Œä¸å½±å“å½“å‰ä½¿ç”¨ï¼‰
